{# catalog/templates/catalog/product_card.html #}
{% load humanize %}
<article class="theme-card rounded-3xl border border-theme shadow-sm">
  <div class="overflow-hidden rounded-t-3xl">
    <div class="relative">
      <a href="{% url 'catalog:detail' p.id %}">
        <img
          src="{{ p.proxied_thumbnail|default:'https://picsum.photos/seed/pilates/960/640' }}"
          alt="{{ p.product_name }}"
          class="h-64 w-full object-cover"
          onerror="this.onerror=null;this.src='https://picsum.photos/seed/pilates-fallback/960/640';"
        />
      </a>
      {% if not p.inStock %}
      <div class="absolute inset-0 grid place-items-center bg-black/40">
        <span class="rounded-full bg-white/90 px-4 py-2 text-sm font-semibold text-gray-800">Out of Stock</span>
      </div>
      {% endif %}
    </div>
  </div>
  <div class="px-6 pb-6 pt-5">
    <h3 class="text-lg font-semibold">
      <a href="{% url 'catalog:detail' p.id %}" class="hover:underline">
        {{ p.product_name }}
      </a>
    </h3>
    {% if p.description %}
      <p class="mt-1" style="color:var(--muted-foreground)">{{ p.description|truncatechars:90 }}</p>
    {% endif %}
    <p class="mt-4 text-2xl font-semibold" style="color:var(--primary)">Rp{{ p.price|intcomma }}</p>
    <div class="mt-5 flex gap-2">
      <a href="{% url 'catalog:detail' p.id %}"
        class="inline-flex flex-1 items-center justify-center rounded-xl border border-theme px-4 py-3 text-sm font-medium theme-card hover:opacity-90">
        Detail
      </a>

      {% if user.is_authenticated %}
        <form method="post" action="{% url 'cart:add' p.id %}" class="flex-1">
          {% csrf_token %}
          <button type="submit"
                  class="btn-primary inline-flex w-full items-center justify-center gap-2 rounded-xl px-4 py-3 text-sm font-medium">
            Add to Cart
          </button>
        </form>
      {% else %}
        <a href="/user/login/"
          class="btn-primary inline-flex flex-1 items-center justify-center gap-2 rounded-xl px-4 py-3 text-sm font-medium">
          Add to Cart
        </a>
      {% endif %}
    </div>
  </div>
</article>
