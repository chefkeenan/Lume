{% extends "base.html" %}
{% load static humanize %}

{% include "product_modal.html" %}

{% block title %}Shop — Lume{% endblock %}

{% block content %}

<!-- HERO — title di atas gambar (center) -->
<section class="relative mx-auto max-w-7xl px-6 pt-8">
  <div class="relative overflow-hidden rounded-[28px]">
    <img src="{% static 'hero/hero-products.png' %}" alt="" class="h-[300px] w-full object-cover">
    <!-- overlay gradasi lebih soft biar gambar jelas -->
    <div class="absolute inset-0 bg-[linear-gradient(180deg,rgba(0,0,0,.22)_0%,rgba(0,0,0,.12)_45%,rgba(0,0,0,.04)_100%)]"></div>

    <div class="absolute inset-0 grid place-items-center">
      <div class="text-center text-white drop-shadow max-w-3xl px-6">
        <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight">Premium Products</h1>
        <p class="mt-2 text-white/90">
          Discover our carefully curated selection of pilates and wellness products to enhance your practice
        </p>
        <a href="#grid"
           class="mt-5 inline-flex items-center gap-2 rounded-full border border-white/60 bg-white/15 px-5 py-2 font-semibold hover:bg-white/25">
          Lihat Lebih Lanjut ↓
        </a>
      </div>
    </div>
  </div>
</section>

<!-- FILTER & SORT (dropdown) -->
<section class="mx-auto max-w-7xl px-6 mt-6">
  <div class="flex items-center justify-between">
    <!-- Dropdown HARGA (native <details>) -->
    <details class="relative">
      <summary class="list-none inline-flex items-center gap-2 rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm cursor-pointer select-none">
        <span class="font-medium">Filter</span>
        {% if selected_price %}
          {% for key, label, _lo, _hi in price_ranges %}
            {% if key == selected_price %}
              <span class="rounded-full bg-stone-100 px-2 py-0.5 text-xs text-stone-700">{{ label }}</span>
            {% endif %}
          {% endfor %}
        {% else %}
          <span class="text-stone-500">All Prices</span>
        {% endif %}
        <svg class="h-4 w-4 opacity-70" viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"/></svg>
      </summary>

      <div class="absolute z-10 mt-2 w-56 rounded-xl border border-stone-200 bg-white p-2 shadow-lg">
        <form method="get" class="space-y-1">
          <button type="submit" name="price" value=""
                  class="w-full text-left px-3 py-2 rounded-lg hover:bg-stone-100 text-sm {% if not selected_price %}bg-stone-100{% endif %}">
            All Prices
          </button>
          {% for key, label, _lo, _hi in price_ranges %}
          <button type="submit" name="price" value="{{ key }}"
                  class="w-full text-left px-3 py-2 rounded-lg hover:bg-stone-100 text-sm {% if selected_price == key %}bg-stone-100{% endif %}">
            {{ label }}
          </button>
          {% endfor %}
        </form>
      </div>
    </details>

    <!-- Dropdown SORT -->
    <form method="get" class="hidden md:block">
      <select name="order" class="rounded-xl border border-stone-300 bg-white px-3 py-2 text-sm"
              onchange="this.form.submit()">
        <option value="">Urut default</option>
        <option value="price" {% if order == 'price' %}selected{% endif %}>Harga: Termurah</option>
        <option value="-price" {% if order == '-price' %}selected{% endif %}>Harga: Termahal</option>
      </select>
      {% if selected_price %}<input type="hidden" name="price" value="{{ selected_price }}">{% endif %}
    </form>
  </div>
</section>

<!-- GRID PRODUK -->
<section id="grid" class="mx-auto max-w-7xl px-6 py-8">
  <div class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3">
    {% for p in page_obj.object_list %}
      {# file kamu ada di catalog/templates/catalog/product_card.html #}
      {% include "product_card.html" with p=p %}
    {% empty %}
      <p class="col-span-full text-stone-500">Belum ada produk.</p>
    {% endfor %}
  </div>

  {# --- Paginator SAFE tanpa tanda kurung --- #}
{% if page_obj.paginator.num_pages > 1 %}
  <div class="mt-8 flex items-center justify-center gap-1">

    {# Prev #}
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}{% if selected_price %}&price={{ selected_price }}{% endif %}{% if order %}&order={{ order }}{% endif %}"
         class="px-3 py-2 rounded-full border">←</a>
    {% else %}
      <span class="px-3 py-2 rounded-full border opacity-40 cursor-not-allowed">←</span>
    {% endif %}

    {# Page numbers: 1, 2, current-1..current+1, last-1, last #}
    {% for num in page_obj.paginator.page_range %}
      {% if num == page_obj.number %}
        <span class="px-3 py-2 rounded-full bg-[#9AA08F] text-white">{{ num }}</span>

      {% elif num <= 2 %}
        <a href="?page={{ num }}{% if selected_price %}&price={{ selected_price }}{% endif %}{% if order %}&order={{ order }}{% endif %}"
           class="px-3 py-2 rounded-full border">{{ num }}</a>

      {% elif num >= page_obj.paginator.num_pages|add:"-1" %}
        <a href="?page={{ num }}{% if selected_price %}&price={{ selected_price }}{% endif %}{% if order %}&order={{ order }}{% endif %}"
           class="px-3 py-2 rounded-full border">{{ num }}</a>

      {% elif num >= page_obj.number|add:"-1" and num <= page_obj.number|add:"1" %}
        <a href="?page={{ num }}{% if selected_price %}&price={{ selected_price }}{% endif %}{% if order %}&order={{ order }}{% endif %}"
           class="px-3 py-2 rounded-full border">{{ num }}</a>

      {% elif forloop.counter == 3 or num == page_obj.paginator.num_pages|add:"-2" %}
        <span class="px-3 py-2">…</span>
      {% endif %}
    {% endfor %}

    {# Next #}
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if selected_price %}&price={{ selected_price }}{% endif %}{% if order %}&order={{ order }}{% endif %}"
         class="px-3 py-2 rounded-full border">→</a>
    {% else %}
      <span class="px-3 py-2 rounded-full border opacity-40 cursor-not-allowed">→</span>
    {% endif %}

  </div>
{% endif %}

</section>

{# ...isi halaman shop kamu... #}


<script src="{% static 'catalog/js/helpers.js' %}"></script>
<script src="{% static 'catalog/js/shop.js' %}"></script>


{% endblock %}
