{% extends "base.html" %}
{% load static humanize %}

{% include "product_modal.html" %}

{% block title %}Shop — Lume{% endblock %}

{% block content %}

<!-- HERO — title di atas gambar (center) -->
<section class="relative mx-auto max-w-7xl px-6 pt-8">
  <div class="relative overflow-hidden rounded-[28px]">
    <img src="{% static 'hero/hero-products.png' %}" alt="" class="h-[300px] w-full object-cover">
    <!-- overlay gradasi lebih soft biar gambar jelas -->
    <div class="absolute inset-0 bg-[linear-gradient(180deg,rgba(0,0,0,.22)_0%,rgba(0,0,0,.12)_45%,rgba(0,0,0,.04)_100%)]"></div>

    <div class="absolute inset-0 grid place-items-center">
      <div class="text-center text-white drop-shadow max-w-3xl px-6">
        <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight">Shop All Products</h1>
        <p class="mt-2 text-white/90">
          Discover our carefully curated selection of pilates and wellness products to enhance your practice
        </p>
        <a href="#grid"
           class="mt-5 inline-flex items-center gap-2 rounded-full border border-white/60 bg-white/15 px-5 py-2 font-semibold hover:bg-white/25">
          See More ↓
        </a>
      </div>
    </div>
  </div>
</section>

<!-- SEARCH + FILTER BAR -->
<section class="mx-auto max-w-7xl px-6 mt-10">
  <form action="{% url 'main:show_main' %}" method="get" class="flex items-center gap-2">
    {% if order %}<input type="hidden" name="order" value="{{ order }}">{% endif %}

    <!-- Input Search -->
    <div class="relative flex-1">
      <svg class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-stone-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M13.78 12.72a6 6 0 11.707-.707l3.25 3.25a.5.5 0 01-.707.707l-3.25-3.25zM12.5 8a4.5 4.5 0 10-9 0 4.5 4.5 0 009 0z" clip-rule="evenodd" />
      </svg>
      <input
        id="q" name="q" type="search" value="{{ q|default:'' }}"
        placeholder="Search"
        class="w-full rounded-lg border border-stone-300 bg-white py-2.5 pl-9 pr-3 text-sm text-stone-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-stone-300"
      />
    </div>

    <!-- Dropdown Filter (Price) -->
    <div>
      <label for="price" class="sr-only">Filter</label>
      <div class="relative">
        <select
          id="price" name="price"
          class="appearance-none rounded-lg border border-stone-300 bg-white px-3 py-2.5 pr-8 text-sm text-stone-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-stone-300"
        >
          <option value="">Filter</option>
          {% for key, label, _lo, _hi in price_ranges %}
            <option value="{{ key }}" {% if selected_price == key %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
        <svg class="pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-stone-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd" />
        </svg>
      </div>
    </div>

    <!-- Tombol Search -->
    <button
      type="submit"
      class="rounded-lg bg-[#9AA08F] px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:opacity-95 active:opacity-90"
    >
      Search
    </button>
  </form>
</section>

<!-- GRID PRODUK -->
<section id="grid" class="relative z-0 mx-auto max-w-7xl px-6 py-8">
  <div class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3">
    {% for p in page_obj.object_list %}
      {% include "product_card.html" with p=p %}
    {% empty %}
      <p class="col-span-full text-stone-500">Belum ada produk.</p>
    {% endfor %}
  </div>

  {% if page_obj.paginator.num_pages > 1 %}
  <div class="mt-8 flex items-center justify-center gap-1">

    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}{% if selected_price %}&price={{ selected_price }}{% endif %}{% if order %}&order={{ order }}{% endif %}"
         class="px-3 py-2 rounded-full border">←</a>
    {% else %}
      <span class="px-3 py-2 rounded-full border opacity-40 cursor-not-allowed">←</span>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
      {% if num == page_obj.number %}
        <span class="px-3 py-2 rounded-full bg-[#9AA08F] text-white">{{ num }}</span>
      {% elif num <= 2 %}
        <a href="?page={{ num }}{% if q %}&q={{ q|urlencode }}{% endif %}{% if selected_price %}&price={{ selected_price }}{% endif %}{% if order %}&order={{ order }}{% endif %}"
           class="px-3 py-2 rounded-full border">{{ num }}</a>
      {% elif num >= page_obj.paginator.num_pages|add:"-1" %}
        <a href="?page={{ num }}{% if q %}&q={{ q|urlencode }}{% endif %}{% if selected_price %}&price={{ selected_price }}{% endif %}{% if order %}&order={{ order }}{% endif %}"
           class="px-3 py-2 rounded-full border">{{ num }}</a>
      {% elif num >= page_obj.number|add:"-1" and num <= page_obj.number|add:"1" %}
        <a href="?page={{ num }}{% if q %}&q={{ q|urlencode }}{% endif %}{% if selected_price %}&price={{ selected_price }}{% endif %}{% if order %}&order={{ order }}{% endif %}"
           class="px-3 py-2 rounded-full border">{{ num }}</a>
      {% elif forloop.counter == 3 or num == page_obj.paginator.num_pages|add:"-2" %}
        <span class="px-3 py-2">…</span>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q|urlencode }}{% endif %}{% if selected_price %}&price={{ selected_price }}{% endif %}{% if order %}&order={{ order }}{% endif %}"
         class="px-3 py-2 rounded-full border">→</a>
    {% else %}
      <span class="px-3 py-2 rounded-full border opacity-40 cursor-not-allowed">→</span>
    {% endif %}
  </div>
  {% endif %}
</section>

<script src="{% static 'catalog/js/helpers.js' %}"></script>
<script src="{% static 'catalog/js/shop.js' %}"></script>

{% endblock %}
